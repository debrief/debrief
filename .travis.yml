language: java
jdk: oraclejdk8
sudo: required
cache:
  directories:
  - "$HOME/.m2"
env:
  global:
    secure: JcJdT/fdbk82jp2LM0B+YulB+adDQAy3MXUSpO8yLIkA0/371Z1fywltSnkpYl9YgVdu54jCym3ScWu2SeppQr6mHNeyUzzW7vThFBzBZux+451WR8ly2lqDqgByePkvuTxOqsk9fEfOSpNHfA02aiNWYFX9nZtHcdV/ZrQxqiY=
install:
- mvn --version
addons:
  apt:
    packages:
    - pdftk
notifications:
  slack: debrief-devs:GF1nQSqn2eozH3wQtyuPLAlG
before_script:
- export DISPLAY=:99
- sh -e /etc/init.d/xvfb start
- sleep 3
script: mvn clean verify -U -B -fae
after_success: ls /home/travis/build/debrief/debrief/org.mwc.cmap.combined.feature/root_installs
deploy:
- provider: releases
  skip_cleanup: true
  file_glob: true
  api_key:
    secure: KCCJkP6ELz9pIGkBmSRbazRzhKZPq7T58tEIZbthtVv+KoM/JWdN10h3IK/N5Oqdeb2/P5u+93ml1wlU9PkbuwxQ4mpUbaAW41G/9mbEF7U2JLEtS9xSxeIfEBIEtuHxdlECjsgMCLm2lh3CVxbu3S2y9jDnpt35rbh6AN3B44w=
  file:
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Linux64Bit.tar.gz"
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-MacOSX64Bit.tar.gz"
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows32Bit.zip"
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.product/target/products/DebriefNG-Windows64Bit.zip"
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.legacy/dist/DebriefLite*.jar"
  - "/home/travis/build/debrief/debrief/org.mwc.debrief.site/target/update-site/Debrief_UpdateSite.zip"
  on:
    tags: true
    all_branches: true
- provider: pages
  github-token: "$GITHUB_TOKEN"
  local-dir: "/home/travis/build/debrief/debrief/org.mwc.debrief.site/target/site"
  verbose: true
  name: IanMayo
  skip-cleanup: true
  on:
    tags: true
    all_branches: true
# NOTE: this next block of YAML creates a P2 update on the dev pages branch.
# But, since this P2 update will probably contain the same product version
# number as the currently installed version, it won't update.  We need to
# switch to a more fine-grained version number to allow these incremental
# beta updates
#- provider: pages
#  github-token: "$GITHUB_TOKEN"
#  local-dir: "/home/travis/build/debrief/debrief/org.mwc.debrief.site/target/repository"
#  verbose: true
#  target-branch: gh-pages-dev
#  name: IanMayo
#  skip-cleanup: true
#  on:
#    tags: false
#    all_branches: develop
